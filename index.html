<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Status</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #333;
        }
        .search-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .search-container input,
        .search-container select,
        .search-container button {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 16px;
        }
        th {
            background: #007bff;
            color: white;
        }
        .paid {
            background: #d4edda;
            color: #155724;
            font-weight: bold;
        }
        .due {
            background: #f8d7da;
            color: #721c24;
            font-weight: bold;
        }
        .penalty {
            background: #ffc107;
            color: #333;
            font-weight: bold;
        }
        .summary {
            font-size: 18px;
            font-weight: bold;
            color: green;
            text-align: right;
            margin-top: 10px;
        }
        .qr-container {
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        .qr-container img {
            width: 150px;
            height: 150px;
        }
        .contact-text {
            font-size: 18px;
            font-weight: bold;
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Player Payment Status</h2>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Enter ID or Name">
            
            <select id="howPayFilter">
                <option value="">Select Payment Type</option>
                <option value="Month by month">Month by Month</option>
                <option value="Half year">Half Year</option>
                <option value="Year">Year</option>
            </select>
            
            <select id="monthFilter">
                <option value="">Select Month</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>

            <button onclick="searchPlayer()">Search</button>
        </div>

        <p class="summary" id="totalAmountText"></p>

        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Contact No.</th>
                    <th>How Pay</th>
                    <th>Month</th>
                    <th>Due Date</th>
                    <th>Pay Date</th>
                    <th>Amount</th>
                    <th>Penalty</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="resultTable">
                <!-- Results will be displayed here -->
            </tbody>
        </table>

        <div class="qr-container" id="qrContainer">
            <p class="contact-text">If you want to pay, please contact us at: <strong>+1234567890</strong></p>
            <img src="QR.png" alt="QR Code">
        </div>
    </div>

    <script>
        let playerData = [];

        async function fetchGoogleSheetData() {
            const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQk-NnkqUCm5JEiQSXBqJs54MC5_Wu5JK-G9u3uT6B80gezZ1HrCKdDbpregRm1O1e6RK--BmJe2qGJ/pub?output=csv";
            
            try {
                const response = await fetch(sheetURL);
                const csvText = await response.text();
                const rows = csvText.split("\n").map(row => row.split(","));
                
                playerData = rows.slice(1).map(row => ({
                    id: row[0]?.trim() || "",
                    name: row[1]?.trim() || "",
                    contact: row[2]?.trim() || "",
                    howPay: row[3]?.trim() || "",
                    month: row[4]?.trim() || "",
                    dueDate: row[5]?.trim() || "",
                    payDate: row[6]?.trim() || "",
                    amount: parseFloat(row[7]?.trim() || "0")
                }));

            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        function searchPlayer() {
            let searchValue = document.getElementById("searchInput").value.toLowerCase();
            let selectedMonth = document.getElementById("monthFilter").value;
            let selectedHowPay = document.getElementById("howPayFilter").value;
            let tableBody = document.getElementById("resultTable");
            let totalAmountText = document.getElementById("totalAmountText");
            let qrContainer = document.getElementById("qrContainer");
            tableBody.innerHTML = "";
            totalAmountText.textContent = "";
            qrContainer.style.display = "none";

            let hasPendingPayment = false;
            let totalAmount = 0;

            let filteredData = playerData.filter(player => {
                return (
                    (player.id.toLowerCase().includes(searchValue) || player.name.toLowerCase().includes(searchValue)) &&
                    (selectedHowPay === "" || player.howPay === selectedHowPay) &&
                    (selectedHowPay === "Month by month" ? (selectedMonth === "" || player.month === selectedMonth) : true)
                );
            });

            filteredData.forEach(player => {
                let statusClass = "paid";
                let dueDate = new Date(player.dueDate.split("-").reverse().join("-"));
                let today = new Date();
                let penalty = 0;

                if (!player.payDate) {
                    let daysOverdue = Math.floor((today - dueDate) / (1000 * 60 * 60 * 24));
                    if (daysOverdue > 0) penalty += 20;
                    if (daysOverdue > 7) penalty += 20;
                    statusClass = "due";
                    hasPendingPayment = true;
                }

                totalAmount += (player.amount + penalty);

                let row = `<tr class="${statusClass}">
                    <td>${player.id}</td>
                    <td>${player.name}</td>
                    <td>${player.contact}</td>
                    <td>${player.howPay}</td>
                    <td>${player.month}</td>
                    <td>${player.dueDate}</td>
                    <td>${player.payDate || "Not Paid"}</td>
                    <td>${player.amount}</td>
                    <td>${penalty}</td>
                    <td>${player.amount + penalty}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });

            if (hasPendingPayment) qrContainer.style.display = "block";
            totalAmountText.textContent = `Total Amount: â‚¹${totalAmount}`;
        }

        fetchGoogleSheetData();
    </script>
</body>
</html>
